# CGANs for surrogate modeling of wind turbine loads

- Primary developer: Li-Toong Yap
- Source of the base code: https://github.com/joeloskarsson/CGAN-regression
- Maintainance/ usage: Deepali Singh

# Dependencies
This project uses Python 3.10. The dependencies can be installed via

```
pip3 install -r requirements.txt
```

The main dependencies are:

- matplotlib==3.6.3
- numpy==1.24.2
- pandas==1.5.3
- POT==0.8.2
- torch==1.13.1
- scikit-learn==1.2.1
- seaborn==0.12.2

# Directory structure

```bash
cgan
├── cgan_specs  # Folder containing .json config files for neural network architecture of CGANs 
│   └──...       
├── config      # Folder containing .json config files
│   └──... 
├── datasets    # Folder containing real-world datasets
│   ├── aero
│   │	├──raw_data
│   │	│  └──...
│   │	├──train.csv
│   │	├──test.csv
│   │	└──val.csv
│   ├── aerohydro
│   │	└──...
│   ├── aerohydro_MDN
│   │	└──...
│   └── aero_MDN
│   	└──...
├── dataset_specifications # Folder containing specifications of real-world datasets
│   └── ....
├── scripts_synthetic-ds  # Folder containing standalone scripts for some synthetic datasets
│   ├── CGAN_1D-GM.py
│   ├── CGAN_heteroscedastic.py
│   └── CGAN_wmix.py
├── CGAN_aerohydro.py # .py script for running the Aerohydro dataset experiments
├── CGAN_aero-MDN.py # .py script for running the Aero_MDN dataset experiments
├── CGAN_aero.py # .py script for running the Aero dataset experiments
├── cgan.py # General CGAN model
├── cgan_versions.py # Alternative CGAN models (f-CGAN, WCGAN-GP)
├── dataset_list.py # List of dataset specifications
├── evaluation.py # Evaluation of CGAN outputs for validation/testing
├── misc_funcs.py # Miscellaneous functions used in CGAN training
├── networks.py # Architectures of neural networks
├── noise_dists.py # Noise distributions
├── preprocess.py # Preprocessing script for datasets specified in dataset_list.py
├── README.md
├── requirements.txt # Requirements for this code
└── tabular_dataset.py # Custom Pytorch dataset class

```
# Datasets
With the exception of the aero_MDN dataset, all synthetic datasets can be generated by running the relevant 
`.py`
file in the `scripts_synthetic-ds/` directory. The details of each dataset, together with the preprocessing, is self-contained in each file. 

Real-world datasets and the aero_MDN dataset can be found in the `datasets` directory. The subdirectories of each dataset are the same;an example is shown for the Aero dataset. The raw data and the preprocessed (normalised) data can be found in each folder. To preprocess the dataset simply run

```
python3 preprocess.py --dataset dataset_name
```
Using `preprocess.py` requires an existing specification file e.g. `dataset_specifications/aero.py`
To include additional datasets similar to the existing real-world datasets for preprocessing, start by using one of the existing specifications as a template. 

# Training
Training is done by running the relevant `.py` files in the main directory or in the `scripts_synthetic-ds/` directory. **The files should be run from the directory that they are in, otherwise there will be a** `module not found` **error.** 

For each script, the arguments can be passed as a `.json` file:
```
python3 CGAN_aero.py --config path/to/config/config.json
```
Sample `.json` files are given in the `config/` directory. For a full list of available arguments pass the `--help` flag to the file e.g.
```
python3 CGAN_aero.py --help
```
They can also be found in the `misc_funcs.py` under the function `get_config()` 

To specify the networks for the CGAN, a `.json` file like the ones in the `cgan_specs/` directory are used. The path to the `.json` files are specified in the config file in the `config/` directory.

For the real-world and aero_MDN datasets, the files have a dependency on the dataset specifications in the `dataset_specifications/` directory. Specifically, properties such as the name of the dataset `name`, the input `X_DIM` and output `Y_DIM` dimensions, the load channel to be trained on `CHANNEL_NAME`, the inputs `DATASET_INPUTS` and the name of the subfolder `DATASET_NAME` that the results are saved to. 
These variables are found at the beginning of each file. If there is no dataset specification file, the relevant variables will have to be updated accordingly.

The `CGAN_aero-MDN.py` file has an extra variable `selections` at the beginning of the file that specifies the name of the folder with the relevant size of the dataset. Different training sizes of the aero_MDN dataset are given in the `datasets/aero_MDN/` directory.

# To train on a new dataset:
 - place the data in folder datasets/xx in the format (unsorted):
 	feature1 feature2 response1 response2 response3 ...
 - this data is preprocessed using the preprocess.py script which requires a file in dataset_specifications/ like aero.py --> let's call it xx.py. So, modify the xx.py file. Then run 
 	python3 preprocess.py --dataset dataset_name
 	the output of this is three files in the datasets/xx folder as train.csv, test.csv and val.csv
 - modify a file like CGAN_aero.py
 - modify the config file
 - then run 
 	python3 CGAN_aero.py --config path/to/config/config.json
 	
 
